<html>
<head>
	<title>MineNode - extremely primitive Minecraft Server frontend</title>
	<!-- im sry master resig. im a lazy ass, you see (TODO) -->
	<script src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
	<style>
		pre {
			overflow: scroll;
		}

		.logcontainer {
			max-height: 200px;
			max-width: 80%;
			margin: 1em;
			font-family: monospace;
			border: 2px solid #ddd;
		}

		.enabled {
			background-color: #8f8;
		}

		.disabled {
			background-color: #f88;
		}

		#server_properties td {
			border: 1px dotted #ccc;
			padding: 0.3em;
		}

		#server_properties table {
			border-spacing: 0;
			border-collapse: collapse;
		}


	</style>
	<script>
		/*global $*/
		var adminkey = '%%ADMINKEY%%';
	</script>
</head>
<body>
	<h1>Server status</h1>
	<div id="server_status">---</div>
	<button id="server_switch_on">start</button>
	<button id="server_switch_off">stop</button>
	<h1>Server properties</h1>
	<div id="server_properties"></div>
	<h1>Server stdout</h1>
	<div ><pre id="server_stdout" class="logcontainer"></pre></div>
	<h1>Server stderr</h1>
	<div ><pre id="server_stderr" class="logcontainer"></pre></div>
	<div>
		<label for="server_stdin">input:</label>
		<input type="text" size="40" id="server_stdin" />
	</div>
	<script>

	var stdin = '',
		stderr = '',
		stdout = '';

	$('#server_stdin').keyup(function (e) {
		if (e.keyCode === 13) {
			$.get('/' + adminkey + '?type=stdin&message=' + this.value);
			this.value = '';
		}
	});



	$(document).ready(function () {

		var pollStdout = function () {
				$.get('/' + adminkey + '?type=stdout', function (data) {
					stdout += data;
					$('#server_stdout').text(stdout).scrollTop($('#server_stdout')[0].scrollHeight);
					setTimeout(pollStdout, 1000);
				}, 'html');
			},
			pollStderr = function () {
				$.get('/' + adminkey + '?type=stderr', function (data) {
					stderr += data;
					$('#server_stderr').text(stderr).scrollTop($('#server_stderr')[0].scrollHeight);

					setTimeout(pollStderr, 1000);
				}, 'html');
			},
			pollServerStatus = function () {
				$.get('/' + adminkey, {type: 'status'}, function (data) {
					if (data) {
						$('#server_status').addClass('enabled').removeClass('disabled').text('running');
					} else {
						$('#server_status').removeClass('enabled').addClass('disabled').text('stopped');
					}

					setTimeout(pollServerStatus, 3000);
				}, 'json');
			},
			getServerProperties = function () {
				$.get('/' + adminkey, {type: 'properties'}, function (data) {
					var n, s = '<table>';
					for (n in data) {
						if (data.hasOwnProperty(n)) {
							s += '<tr><td>' + n + '<\/td><td>' + data[n] + '<\/td><\/tr>';
						}
					}
					s += '<\/table>';
					$('#server_properties').html(s);

				}, 'json');
			};

		pollStderr();
		pollStdout();
		pollServerStatus();
		getServerProperties();

		$('#server_switch_on').click(function () {
			$.get('/' + adminkey, {type: 'start'});
		});

		$('#server_switch_off').click(function () {
			$.get('/' + adminkey, {type: 'stop'});
		});
	});
	</script>
</body>
</html>